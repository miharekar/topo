/*
 * Google layer using Google Maps API
 *///(function (google, L) {
L.Google=L.Class.extend({includes:L.Mixin.Events,options:{minZoom:0,maxZoom:18,tileSize:256,subdomains:"abc",errorTileUrl:"",attribution:"",opacity:1,continuousWorld:!1,noWrap:!1,mapOptions:{backgroundColor:"#dddddd"}},initialize:function(e,t){L.Util.setOptions(this,t);this._ready=google.maps.Map!=undefined;this._ready||L.Google.asyncWait.push(this);this._type=e||"SATELLITE"},onAdd:function(e,t){this._map=e;this._insertAtTheBottom=t;this._initContainer();this._initMapObject();e.on("viewreset",this._resetCallback,this);this._limitedUpdate=L.Util.limitExecByInterval(this._update,150,this);e.on("move",this._update,this);e.on("zoomanim",this._handleZoomAnim,this);e._controlCorners.bottomright.style.marginBottom="20px";this._reset();this._update()},onRemove:function(e){this._map._container.removeChild(this._container);this._map.off("viewreset",this._resetCallback,this);this._map.off("move",this._update,this);this._map.off("zoomanim",this._handleZoomAnim,this);e._controlCorners.bottomright.style.marginBottom="0em"},getAttribution:function(){return this.options.attribution},setOpacity:function(e){this.options.opacity=e;e<1&&L.DomUtil.setOpacity(this._container,e)},setElementSize:function(e,t){e.style.width=t.x+"px";e.style.height=t.y+"px"},_initContainer:function(){var e=this._map._container,t=e.firstChild;if(!this._container){this._container=L.DomUtil.create("div","leaflet-google-layer leaflet-top leaflet-left");this._container.id="_GMapContainer_"+L.Util.stamp(this);this._container.style.zIndex="auto"}e.insertBefore(this._container,t);this.setOpacity(this.options.opacity);this.setElementSize(this._container,this._map.getSize())},_initMapObject:function(){if(!this._ready)return;this._google_center=new google.maps.LatLng(0,0);var e=new google.maps.Map(this._container,{center:this._google_center,zoom:0,tilt:0,mapTypeId:google.maps.MapTypeId[this._type],disableDefaultUI:!0,keyboardShortcuts:!1,draggable:!1,disableDoubleClickZoom:!0,scrollwheel:!1,streetViewControl:!1,styles:this.options.mapOptions.styles,backgroundColor:this.options.mapOptions.backgroundColor}),t=this;this._reposition=google.maps.event.addListenerOnce(e,"center_changed",function(){t.onReposition()});this._google=e;google.maps.event.addListenerOnce(e,"idle",function(){t._checkZoomLevels()})},_checkZoomLevels:function(){this._google.getZoom()!==this._map.getZoom()&&this._map.setZoom(this._google.getZoom())},_resetCallback:function(e){this._reset(e.hard)},_reset:function(e){this._initContainer()},_update:function(e){if(!this._google)return;this._resize();var t=e&&e.latlng?e.latlng:this._map.getCenter(),n=new google.maps.LatLng(t.lat,t.lng);this._google.setCenter(n);this._google.setZoom(this._map.getZoom());this._checkZoomLevels()},_resize:function(){var e=this._map.getSize();if(this._container.style.width==e.x&&this._container.style.height==e.y)return;this.setElementSize(this._container,e);this.onReposition()},_handleZoomAnim:function(e){var t=e.center,n=new google.maps.LatLng(t.lat,t.lng);this._google.setCenter(n);this._google.setZoom(e.zoom)},onReposition:function(){if(!this._google)return;google.maps.event.trigger(this._google,"resize")}});L.Google.asyncWait=[];L.Google.asyncInitialize=function(){var e;for(e=0;e<L.Google.asyncWait.length;e++){var t=L.Google.asyncWait[e];t._ready=!0;if(t._container){t._initMapObject();t._update()}}L.Google.asyncWait=[]};L.Control.Locate=L.Control.extend({options:{position:"topleft",drawCircle:!0,follow:!1,stopFollowingOnDrag:!1,circleStyle:{color:"#136AEC",fillColor:"#136AEC",fillOpacity:.15,weight:2,opacity:.5},markerStyle:{color:"#136AEC",fillColor:"#2A93EE",fillOpacity:.7,weight:2,opacity:.9,radius:5},followCircleStyle:{},followMarkerStyle:{},icon:"icon-location",iconLoading:"icon-spinner animate-spin",circlePadding:[0,0],metric:!0,onLocationError:function(e){alert(e.message)},onLocationOutsideMapBounds:function(e){e.stopLocate();alert(context.options.strings.outsideMapBoundsMsg)},setView:!0,keepCurrentZoomLevel:!1,strings:{title:"Show me where I am",popup:"You are within {distance} {unit} from this point",outsideMapBoundsMsg:"You seem located outside the boundaries of the map"},locateOptions:{maxZoom:Infinity,watch:!0}},onAdd:function(e){var t=L.DomUtil.create("div","leaflet-control-locate leaflet-bar leaflet-control"),n=this;this._layer=new L.LayerGroup;this._layer.addTo(e);this._event=undefined;this._locateOptions=this.options.locateOptions;L.extend(this._locateOptions,this.options.locateOptions);L.extend(this._locateOptions,{setView:!1});var r={};L.extend(r,this.options.markerStyle,this.options.followMarkerStyle);this.options.followMarkerStyle=r;r={};L.extend(r,this.options.circleStyle,this.options.followCircleStyle);this.options.followCircleStyle=r;var i=L.DomUtil.create("a","leaflet-bar-part leaflet-bar-part-single "+this.options.icon,t);i.href="#";i.title=this.options.strings.title;L.DomEvent.on(i,"click",L.DomEvent.stopPropagation).on(i,"click",L.DomEvent.preventDefault).on(i,"click",function(){n._active&&(n._event===undefined||e.getBounds().contains(n._event.latlng)||!n.options.setView||f())?p():s()}).on(i,"dblclick",L.DomEvent.stopPropagation);var s=function(){n.options.setView&&(n._locateOnNextLocationFound=!0);n._active||e.locate(n._locateOptions);n._active=!0;n.options.follow&&u();n._event?l():c("requesting")},o=function(e){if(n._event&&n._event.latlng.lat===e.latlng.lat&&n._event.latlng.lng===e.latlng.lng&&n._event.accuracy===e.accuracy)return;if(!n._active)return;n._event=e;n.options.follow&&n._following&&(n._locateOnNextLocationFound=!0);l()},u=function(){e.fire("startfollowing",n);n._following=!0;n.options.stopFollowingOnDrag&&e.on("dragstart",a)},a=function(){e.fire("stopfollowing",n);n._following=!1;n.options.stopFollowingOnDrag&&e.off("dragstart",a);l()},f=function(){return n._event===undefined?!1:e.options.maxBounds&&!e.options.maxBounds.contains(n._event.latlng)},l=function(){n._event.accuracy===undefined&&(n._event.accuracy=0);var t=n._event.accuracy;if(n._locateOnNextLocationFound){f()?n.options.onLocationOutsideMapBounds(n):e.fitBounds(n._event.bounds,{padding:n.options.circlePadding,maxZoom:n.options.keepCurrentZoomLevel?e.getZoom():n._locateOptions.maxZoom});n._locateOnNextLocationFound=!1}var r,i;if(n.options.drawCircle){n._following?r=n.options.followCircleStyle:r=n.options.circleStyle;if(!n._circle)n._circle=L.circle(n._event.latlng,t,r).addTo(n._layer);else{n._circle.setLatLng(n._event.latlng).setRadius(t);for(i in r)n._circle.options[i]=r[i]}}var s,o;if(n.options.metric){s=t.toFixed(0);o="meters"}else{s=(t*3.2808399).toFixed(0);o="feet"}var u;n._following?u=n.options.followMarkerStyle:u=n.options.markerStyle;var a=n.options.strings.popup;if(!n._circleMarker)n._circleMarker=L.circleMarker(n._event.latlng,u).bindPopup(L.Util.template(a,{distance:s,unit:o})).addTo(n._layer);else{n._circleMarker.setLatLng(n._event.latlng).bindPopup(L.Util.template(a,{distance:s,unit:o}))._popup.setLatLng(n._event.latlng);for(i in u)n._circleMarker.options[i]=u[i]}if(!n._container)return;n._following?c("following"):c("active")},c=function(e){if(e=="requesting"){L.DomUtil.removeClasses(n._container,"active following");L.DomUtil.addClasses(n._container,"requesting");L.DomUtil.removeClasses(i,n.options.icon);L.DomUtil.addClasses(i,n.options.iconLoading)}else if(e=="active"){L.DomUtil.removeClasses(n._container,"requesting following");L.DomUtil.addClasses(n._container,"active");L.DomUtil.removeClasses(i,n.options.iconLoading);L.DomUtil.addClasses(i,n.options.icon)}else if(e=="following"){L.DomUtil.removeClasses(n._container,"requesting");L.DomUtil.addClasses(n._container,"active following");L.DomUtil.removeClasses(i,n.options.iconLoading);L.DomUtil.addClasses(i,n.options.icon)}},h=function(){n._active=!1;n._locateOnNextLocationFound=n.options.setView;n._following=!1};h();var p=function(){e.stopLocate();e.off("dragstart",a);n.options.follow&&n._following&&a();L.DomUtil.removeClass(n._container,"requesting");L.DomUtil.removeClass(n._container,"active");L.DomUtil.removeClass(n._container,"following");h();n._layer.clearLayers();n._circleMarker=undefined;n._circle=undefined},d=function(e){if(e.code==3&&n._locateOptions.watch)return;p();n.options.onLocationError(e)};e.on("locationfound",o,n);e.on("locationerror",d,n);this.locate=s;this.stopLocate=p;this.stopFollowing=a;return t}});L.Map.addInitHook(function(){if(this.options.locateControl){this.locateControl=L.control.locate();this.addControl(this.locateControl)}});L.control.locate=function(e){return new L.Control.Locate(e)};(function(){var e=function(e,t,n){n=n.split(" ");n.forEach(function(n){L.DomUtil[e].call(this,t,n)})};L.DomUtil.addClasses=function(t,n){e("addClass",t,n)};L.DomUtil.removeClasses=function(t,n){e("removeClass",t,n)}})();(function(e){function u(){window.scrollTo(0,0)}var t=new e.Google("ROADMAP"),n=new e.Google("SATELLITE"),r=new e.Google("TERRAIN"),i=e.tileLayer("http://dl.dropboxusercontent.com/u/88844/topo/z{z}/{y}/{x}.png",{minZoom:10,maxNativeZoom:15,detectRetina:!0,attribution:'Â© <a href="http://mr.si/">Miha Rekar</a>'}),s=e.map("map",{layers:t,minZoom:6}).setView([46,14.7],8);e.control.layers({Google:t,Satellite:n,Terrain:r,Topo:i}).addTo(s);var o=e.control.locate({follow:!0,locateOptions:{maxZoom:15,watch:!0}}).addTo(s);o.locate();s.on("startfollowing",function(){s.on("dragstart",o.stopFollowing)}).on("stopfollowing",function(){s.off("dragstart",o.stopFollowing)});window.addEventListener("orientationchange",u);u()})(L);